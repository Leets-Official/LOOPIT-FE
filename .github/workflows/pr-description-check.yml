name: PR Description Check

on:
  pull_request:
    types: [opened, ready_for_review]

concurrency:
  group: ${{ github.workflow }}-${{ github.head_ref || github.run_id }}
  cancel-in-progress: true

permissions:
  pull-requests: write

jobs:
  check-description:
    name: Check PR description
    runs-on: ubuntu-latest
    if: github.event.pull_request.draft == false

    steps:
      - name: Check if PR has description
        id: check
        run: |
          # í…œí”Œë¦¿ í…ìŠ¤íŠ¸ ì œê±°:
          # - ì œëª© (## ë¡œ ì‹œì‘)
          # - HTML ì£¼ì„ (<!-- -->)
          # - ì²´í¬ë¦¬ìŠ¤íŠ¸ (- [ ])
          # - êµ¬ë¶„ì„  (---)
          # - ë¹ˆ ì¤„
          # - "- Close #" ë§Œ ìˆëŠ” ì¤„
          FILTERED=$(echo "$RAW_BODY" | sed -r \
            -e '/^##/d' \
            -e '/<!--.*-->/d' \
            -e '/^<!--/d' \
            -e '/^-->/d' \
            -e '/^---$/d' \
            -e '/^- \[/d' \
            -e '/^- Close #$/d' \
            -e '/^$/d')

          if [[ -z "${FILTERED//[[:space:]]/}" ]]; then
            echo "empty=true" >> $GITHUB_OUTPUT
          else
            echo "empty=false" >> $GITHUB_OUTPUT
          fi
        env:
          RAW_BODY: ${{ github.event.pull_request.body }}

      - uses: actions/checkout@v4
        if: steps.check.outputs.empty == 'true'
        with:
          sparse-checkout: 'README.md'

      - name: Comment on PR
        if: steps.check.outputs.empty == 'true'
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          gh pr comment ${{ github.event.pull_request.number }} --body \
          "ğŸ‘‹ @${{ github.actor }} PR ì„¤ëª…ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤. ë³€ê²½ ì‚¬í•­ì— ëŒ€í•œ ì„¤ëª…ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”."
